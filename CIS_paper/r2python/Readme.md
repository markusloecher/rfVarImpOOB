Cleaned up versions of the code to facilitate translation to python
